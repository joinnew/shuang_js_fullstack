<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    选择颜色
    <select id="colorSelect">
        <option value="">请选择</option>
        <option value="red">红色</option>
        <option value="blue">蓝色</option>
    </select>
    <br/> 选择内存
    <select id="memeorySelect">
        <option value="">请选择</option>
        <option value="16G">16G</option>
        <option value="32G">32G</option>
    </select>
    <br/> 选择手机类型
    <select id="phoneSelect">
        <option value="">请选择</option>
        <option value="meta系列">mate系列</option>
        <option value="p系列">p系列</option>
        <option value="honor">honor</option>
    </select>
    <br/>输入购买数量
    <input id="numberInput" type="text" />
    <br/> 您选择了颜色:
    <div id="colorInfo"></div>
    您选择的内存:
    <div id="memeoryInfo"></div>
    您选择的手机类型：
    <div id="phoneInfo"></div>
    您选择了数量:
    <div id="numberInfo"></div>
    <button id="nextBtn" disabled="true">请选择手机颜色和购买数量</button>
    <script>
        // 颜色 内存 品牌 一次次去做check 多一个条件 得去改所有跟最后结果有关的地方 事情太多，搞不定，交给别人搞 中介者模式
        const goods = {
            "red|32G|meta系列": 3,
            "red|16G|honor": 5,
            "blue|32G|p系列": 1,
            "blue|16G|p系列": 5,
            "blue|16G|meta系列": 6,
            "blue|32G|meta系列": 6
        };
        const mediator = (function () {
            // 命名空间不被污染
            const colorSelect = document.querySelector('#colorSelect'),
                memeorySelect = document.querySelector('#memeorySelect'),
                phoneSelect = document.querySelector('#phoneSelect'),
                numInput = document.querySelector('#numberInput'),
                colorInfo = document.querySelector('#colorInfo'),
                memeoryInfo = document.querySelector('#memeoryInfo'),
                nextBtn = document.querySelector('#nextBtn'),
                numInfo = document.querySelector('#numberInfo'),
                phoneInfo = document.querySelector('#phoneInfo');


            // 所有的值 所有的check 通过 但也有差异性：相应的info 值为value
            colorSelect.onchange = function () {
                mediator.changed(this);
            }
            // 闭包，不会再立即执行完就销毁，另这里是异步的，其返回值可以在其触发之前返回。
            memeorySelect.onchange = function () {
                mediator.changed(this);
            }
            phoneSelect.onchange = function () {
                mediator.changed(this);
            }
            numInput.oninput = function () {
                mediator.changed(this);
            }
            return {
                changed: function (obj) {
                    // 中介者模式，让我们将复杂的情况收纳至一个中介者对象，之后，新的情况，新的处理，都将集中在changed一处
                    // console.log(obj.value);
                    var color = colorSelect.value,
                        memeory = memeorySelect.value,
                        phone = phoneSelect.value,
                        number = numInput.value;
                    // console.log(phone);

                    // 再多情况，只要改一处地方 也可以是obj.id === 'colorSelect'
                    if (obj === colorSelect) {
                        colorInfo.innerHTML = color;
                    } else if (obj === memeorySelect) {
                        memeoryInfo.innerHTML = memeory;
                    } else if (obj === numInput) {
                        numInfo.innerHTML = number;
                    } else if (obj === phoneSelect) {
                        phoneInfo.innerHTML = phone;
                    }

                    if (!color) {
                        nextBtn.disabled = true;
                        nextBtn.innerHTML = '请选择手机颜色';
                        return;
                    }

                    if (!memeory) {
                        nextBtn.disabled = true;
                        nextBtn.innerHTML = '请选择内存大小';
                        return;
                    }

                    if (!phone) {
                        nextBtn.disabled = true;
                        nextBtn.innerHTML = '请选择合适的手机类型';
                        return;
                    }
                    if (!number || !Number.isInteger(parseInt(number)) || parseInt(number) <= 0) {
                        nextBtn.disabled = true;
                        nextBtn.innerHTML = '请输入正确的数量';
                        return;
                    }

                    let stock = goods[`${color}|${memeory}|${phone}`];
                    // console.log(color + '|' + memeory + '|' + phone);
                    // console.log(goods['color + '|' + memeory + '|' + phone']);
                    // console.log(goods["blue|16G|p系列"]);
                    // console.log(stock);
                    if (number > stock) {
                        nextBtn.disabled = true;
                        nextBtn.innerHTML = '库存不足';
                        return;
                    }

                    nextBtn.disabled = false;
                    nextBtn.innerHTML = '加入购物车';
                }
            }
        })();

    </script>
</body>

</html>